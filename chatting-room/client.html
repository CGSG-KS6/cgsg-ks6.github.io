<!doctype html>
<html>

<head>
  <title>Messenger</title>
  <link rel="stylesheet" href="./client.css">

  <script>
    function sendMessage() {
      let name_changer = document.getElementById("name");
      let message_changer = document.getElementById("message");
      let msg = { name: name_changer.value, message: message_changer.value };

      if (name_changer.value != "" && message_changer.value != "") {
        fetch("/msg", {
          method: "POST",
          headers: { "Contet-Type": "application/json;charset=utf-8" },
          body: JSON.stringify(msg)
        });
        message_changer.value = "";
      }
    }

    function getMessages() {
      let messages_pane = document.getElementById("messages_pane");

      fetch("/msg", { 
        method: "GET",
      })
        .then((result) => {
          return result.text();
        })
        .then((json) => {
          let messages = JSON.parse(json);
          let text = "";

          for (message of messages) {
            text += `${message.name}: ${message.message}<br>`;
          }
          messages_pane.innerHTML  = text;
          tick();
        });
    }

    function tick() {
      setTimeout(getMessages, 500);
    }
  </script>
</head>

<body onload="tick();">
  <div class="message_post">
    <input class="title" placeholder="NAME" type="text" id="name" style="text-align: center; font-size: 30px;">
    <textarea class="text" placeholder="MESSAGE" id="message" style="text-align: center; text-transform: none;"></textarea>
    <input class="title button" type="button" onclick="sendMessage();" value="Send Message" style="font-size: 22px; background-color: #1abc9c;">
  </div>

  <div class="message_display">
    <p id="messages_pane" class="text"></p>
  </div>
</body>

</html>
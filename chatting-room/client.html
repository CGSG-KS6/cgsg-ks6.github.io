<!doctype html>
<html>

<head>
  <title>Messenger</title>
  <link rel="stylesheet" href="./client.css">

  <script>
    function sendMessage() {
      let name_changer = document.getElementById("inputElementName");
      let message_changer = document.getElementById("inputElementMessage");
      let msg = { name: name_changer.value, message: message_changer.value };

      if (name_changer.value != "" && message_changer.value != "") {
        fetch("/msg", {
          method: "POST",
          headers: { "Contet-Type": "application/json;charset=utf-8" },
          body: JSON.stringify(msg)
        });
        message_changer.value = "";
      }
    }

    function getMessages() {
      fetch("/msg", {
        method: "GET",
      })
        .then((result) => {
          return result.text();
        })
        .then((json) => {
          let messages = JSON.parse(json);
          let message_display = document.getElementById("panelMessagesDiaplay");

          while (message_display.children[1])
            message_display.removeChild(message_display.lastChild);

          for (message of messages) {
            let message_element = document.createElement("div");
            let message_author_element = document.createElement("p");
            let message_data = document.createElement("p");

            message_author_element.innerText = message.name;
            message_author_element.classList.add("author");
            message_data.innerText = message.message;
            message_data.classList.add("data");

            message_element.classList.add("messageBox");
            message_element.appendChild(message_author_element);
            message_element.appendChild(message_data);
            message_display.appendChild(message_element);
          }

          tick();
        });
    }

    function tick() {
      setTimeout(getMessages, 500);
    }
  </script>
</head>

<body onload="tick();">
  <div id="panelMessageSending">
    <p id="titleMessgeSending" class="title">Message<br>sending</p>
    <input id="inputElementName" class="text textInput" type="title" placeholder="name">
    <textarea id="inputElementMessage" class="text textInput" placeholder="message"
      onkeyup="if (event.keyCode === 13) sendMessage();"></textarea>
    <input id="inputElementSendMessage" class="title button" type="button" onclick="sendMessage();"
      value="send message">
  </div>

  <div id="panelMessagesDiaplay">
    <p class="title">Messages</p>
  </div>
</body>

</html>